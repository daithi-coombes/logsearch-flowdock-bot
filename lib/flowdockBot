#!/usr/bin/env node

var YAML = require('yamljs'),
	https = require('https'),
	flowdock;

function flowdockBot(){

	this.config = {}
	this.target;

	this.getConfig = function(){
		return this.config;
	}

	this.getFlows = function(fn){
		this.request('/flows', fn);
		return this;
	}

	this.parseResponse = function(fn){
		fn();
	}

	this.request = function(endpoint, fn){

		var callback;
		fn ? callback=fn : callback=this.parseResponse;
		
		https.get(
			this.target+endpoint,
			callback
		);
	}

	this.setConfig = function(obj){
		this.config = obj;
		this.target = 'https://' + this.config.FLOW_TOKEN + '@api.flowdock.com';
	}
}
flowdock = new flowdockBot();

var _ = {

	getBot: function(){
		return flowdock;
	},

	/**
	 * Sets the flowdock config.
	 * @param {object} configYml Location of yaml config file
	 * @return {object} return's this for chaining
	 */
	setConfig: function(obj){
		flowdock.setConfig(obj);
		return this;
	},

	/**
	 * main() method call
	 * @return {object} return's this for chaining
	 */
	run: function(){

		flow = new flowdockBot();
	}
};

module.exports = _;